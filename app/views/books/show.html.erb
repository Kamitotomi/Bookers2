<!-- フラッシュメッセージ -->
<% if flash[:notice] %>
      <div class="flash">
        <p class="text"><%= flash[:notice] %></p>
      </div>
 <% end %>

<div class="body">
	<div class="container">
		<p id="notice"></p>

		<div class="row">
			<div class="col-xs-3">
				<%= render 'users/cope', user: @user %>
				<!-- 新規投稿部分（共通テンプレ？） -->
				<%= render 'books/list', book: @book %>
			</div>

			<!-- ログインユーザーの投稿一覧 -->

			<div class="col-xs-9">
				<h2>Book detail</h2>

				<table class="table table-hover table-inverse">
					
					<thead>
						<tr>
							<th></th>
							<th>Title</th>
							<th>Opinion</th>
							<th colspan="3"></th>
						</tr>
					</thead>
					<!-- 繰り返さない -->
					
						<tbody>
							<tr>
								<td>
									<%= link_to user_path(@books.user_id) do %>
									<%= attachment_image_tag @user, :profile_image, :fill, 40, 40, format: 'jpeg', class: "img-circle pull-left profile-img", fallback: "no_image.jpg" %>  
									<p><%= @user.name %></p>
									<% end %>
								
								</td>
								
								
								<td><%= @books.title %></td> 
								
								<td><%= @books.body %></td>

								<!-- いいね表示 -->
								<td>
          
          							<% if @books.favorited_by?(current_user) %>
            							<%= link_to book_favorites_path(@books, redirect_id: 0), method: :delete do %>
              							<span class="glyphicon glyphicon-heart"><%= @books.favorites.count%></span>
            							<% end %>
          								
          								<% else %>
            							
            							<%= link_to book_favorites_path(@books, redirect_id: 0), method: :post do %>
              							<span class="glyphicon glyphicon-heart-empty"><%= @books.favorites.count %></span>
            							<% end %>
          							<% end %>
        						</td>

								<td>コメント数:<%= @books.book_comments.count %></td>
								
								<% if @books.user == current_user %>
								<td><%= link_to "Edit", edit_book_path(@books) %></td>
								
								<td><%= link_to "Destroy", book_path(@books), method: :delete, "data-confirm" => "本当に消しますか？" %></td>
								<% end %>
								
								
							

							</tr>
						</tbody>
					
				</table>
				

				<% @book_comments.each do |book_comment| %>
					
					<%= link_to user_path(book_comment.user_id) do %>
						<%= attachment_image_tag book_comment.user, :profile_image, :fill, 40, 40, format: 'jpeg', class: "img-circle pull-left profile-img", fallback: "no_image.jpg" %>  
									<p><%= book_comment.user.name %></p>
					<% end %>
					
						<%= book_comment.comment %>

						<% if book_comment.user == current_user%>
  							<div>
   								<%= link_to "削除", book_book_comment_path(book_comment.book, book_comment), method: :delete, class: "btn btn-danger pull-right" %>
  							</div>
						<% end %>
				<% end %>


				<%= form_for [@books, @book_comment] do |f| %>
					<%= f.text_area :comment,  rows:'5', class: "form-control",placeholder: "コメントをここに" %>
  					<%= f.submit 'コメントする' %>
				<% end %>
				
			</div>
			
		</div>
		
	</div>
	
</div>